CREATE OR REPLACE VIEW VW_TRACKER_DEPARTMENT_RETURN_MATERIAL AS 
 SELECT requis.material_requisition_id,
    requis.issue_min_date,
    requis.issue_max_date,
    requis.transaction_id,
    requis.delivery_min_date,
    requis.delivery_max_date,
    requis.category_name,
    requis.style_code,
    requis.designer_code,
    requis.color_code,
    requis.product_codes,
    requis.item_code,
    requis.production_types,
    requis.material_code,
    requis.material_type,
    requis.material_colour,
    requis.material_total_quantity,
    requis.total_amount,
    requis.sample_reference,
    requis.approved,
    orders.order_id,
    orders.material_order_no,
    orders.customized,
    NULL::integer AS custom_order_id,
    0 AS custom_material_total_quantity,
    0 AS custom_total_amount,
    orders.designer_not_accepted_reason AS REASON
   FROM tracker_orders_material orders
     JOIN tracker_requisition_material requis ON orders.material_requisition_id = requis.material_requisition_id
  WHERE orders.issued = 'Y' AND orders.delivered='Y' AND orders.designer_returned='Y' AND orders.department_returned_date IS NULL
UNION ALL
 SELECT requis.material_requisition_id,
    requis.issue_min_date,
    requis.issue_max_date,
    requis.transaction_id,
    requis.delivery_min_date,
    requis.delivery_max_date,
    requis.category_name,
    requis.style_code,
    requis.designer_code,
    requis.color_code,
    requis.product_codes,
    requis.item_code,
    requis.production_types,
    requis.material_code,
    requis.material_type,
    requis.material_colour,
    custom_orders.material_total_quantity,
    custom_orders.total_amount,
    requis.sample_reference,
    requis.approved,
    orders.order_id,
    orders.material_order_no,
    orders.customized,
    custom_orders.material_custom_order_id AS custom_order_id,
    custom_orders.material_total_quantity AS custom_material_total_quantity,
    custom_orders.total_amount AS custom_total_amount,
    custom_orders.designer_not_accepted_reason AS REASON
   FROM tracker_custom_orders_material custom_orders
     JOIN tracker_orders_material orders ON orders.order_id = custom_orders.order_id
     JOIN tracker_requisition_material requis ON orders.material_requisition_id = requis.material_requisition_id
  WHERE custom_orders.issued = 'Y' AND custom_orders.delivered='Y' AND custom_orders.designer_returned='Y' AND custom_orders.department_returned_date IS NULL;
