CREATE OR REPLACE VIEW VW_TRACKER_ORDER_RAISED_EMBROIDERY
AS
select 
orders.order_id,
embrd_order_no,
orders.embrd_requisition_id,
orders.embrd_custom_requisition_id,
custom_requisition,
issue_min_date,
issue_max_date,
transaction_id,
delivery_min_date,
delivery_max_date,
category_name,
style_code,
designer_code,
color_code,
product_codes,
item_code,
production_types,
embrd_code,
embrd_desc,
embrd_std_unit, 
fabric_name,
fabric_base_colour,
material_reference,
(case when custom_requisition='Y' then custom_requis.embrd_total_metre else requis.embrd_total_metre end) AS embrd_total_metre,
(case when custom_requisition='Y' then custom_requis.embrd_total_pcs else requis.embrd_total_pcs end) AS embrd_total_pcs,
(case when custom_requisition='Y' then custom_requis.embrd_total_set else requis.embrd_total_set end) AS embrd_total_set,
(case when custom_requisition='Y' then custom_requis.embrd_total_line else requis.embrd_total_line end) AS embrd_total_line,
(case when custom_requisition='Y' then custom_requis.embrd_total_length_inch1 else requis.embrd_total_length_inch1 end) AS embrd_total_length_inch1,
(case when custom_requisition='Y' then custom_requis.embrd_total_width_inch2 else requis.embrd_total_width_inch2 end) AS embrd_total_width_inch2,
(case when custom_requisition='Y' then custom_requis.embrd_total_height_inch3 else requis.embrd_total_height_inch3 end) AS embrd_total_height_inch3,
(case when custom_requisition='Y' then custom_requis.embrd_total_measurement else requis.embrd_total_measurement end) AS embrd_total_measurement
FROM TRACKER_ORDERS_EMBROIDERY orders 
LEFT JOIN TRACKER_REQUISITION_EMBROIDERY requis ON orders.embrd_requisition_id=requis.embrd_requisition_id
LEFT JOIN TRACKER_CUSTOM_REQUISITION_EMBROIDERY custom_requis ON orders.embrd_custom_requisition_id=custom_requis.embrd_custom_requisition_id AND custom_requis.approved='Y'
 WHERE (requis.approved='Y' OR custom_requis.approved='Y') AND orders.issued IS NULL;
