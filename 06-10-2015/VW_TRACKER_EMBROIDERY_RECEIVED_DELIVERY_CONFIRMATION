CREATE OR REPLACE VIEW VW_TRACKER_EMBROIDERY_RECEIVED_DELIVERY_CONFIRMATION
AS
select 
orders.order_id,
embrd_custom_order_id,
embrd_order_no,
orders.embrd_requisition_id, 
embrd_custom_requisition_id, 
customized,
custom_requisition,
issued_date AS Actual_Issued_Date,
(case when customized='Y' then custom_orders.received_date else  orders.actual_delivery_date end) AS Actual_Delivery_Date,
issue_min_date,
issue_max_date,
transaction_id,
delivery_min_date,
delivery_max_date,
category_name,
style_code,
designer_code,
color_code,
product_codes,
item_code, 
production_types,
embrd_code,
embrd_desc,
embrd_std_unit,
fabric_name,
fabric_base_colour,
material_reference,
(case when customized='Y' then custom_orders.embrd_total_metre else requis.embrd_total_metre end) AS embrd_total_metre,
(case when customized='Y' then custom_orders.embrd_total_pcs else requis.embrd_total_pcs end) AS embrd_total_pcs,
(case when customized='Y' then custom_orders.embrd_total_set else requis.embrd_total_set end) AS embrd_total_set,
(case when customized='Y' then custom_orders.embrd_total_line else requis.embrd_total_line end) AS embrd_total_line,
(case when customized='Y' then custom_orders.embrd_total_length_inch1 else requis.embrd_total_length_inch1 end) AS embrd_total_length_inch1,
(case when customized='Y' then custom_orders.embr_total_width_inch2 else requis.embrd_total_width_inch2 end) AS embrd_total_width_inch2,
(case when customized='Y' then custom_orders.embrd_total_height_inch3 else requis.embrd_total_height_inch3 end) AS embrd_total_height_inch3,
(case when customized='Y' then custom_orders.embrd_total_measurement else requis.embrd_total_measurement end) AS embrd_total_measurement
FROM TRACKER_ORDERS_EMBROIDERY orders
LEFT JOIN TRACKER_CUSTOM_RECEIVED_ORDERS_EMBROIDERY custom_orders ON custom_orders.order_id=orders.order_id
JOIN TRACKER_REQUISITION_EMBROIDERY requis ON orders.embrd_requisition_id=requis.embrd_requisition_id 
WHERE orders.issued = 'Y' AND (custom_orders.order_id IS NOT NULL  OR (orders.delivered = 'Y' AND  orders.designer_received IS NULL)) ;
