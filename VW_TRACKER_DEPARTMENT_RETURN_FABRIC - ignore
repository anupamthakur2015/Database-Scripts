CREATE OR REPLACE VIEW VW_TRACKER_DEPARTMENT_RETURN_FABRIC
AS
select 
requis.fabric_requisition_id,
    requis.issue_min_date,
    requis.issue_max_date,
    requis.transaction_id,
    requis.delivery_min_date,
    requis.delivery_max_date,
    requis.category_name,
    requis.style_code,
    requis.designer_code,
    requis.color_code,
    requis.product_codes,
    requis.item_code,
    requis.production_types,
    requis.fabric_code,
    requis.fabric_name,
    requis.fabric_type,
    requis.fabric_length,
    requis.fabric_width,
    requis.fabric_shrinkage,
    requis.fabric_pcs,
    requis.fabric_total_measurement,
    requis.approved,
    orders.order_id,
    orders.fabric_order_no,
    orders.customized,
    NULL AS custom_order_id,
    0 AS custom_fabric_length,
    0 AS custom_fabric_width,
    0 AS custom_fabric_shrinkage,
    0 AS custom_fabric_pcs,
    0 AS custom_fabric_total_measurement,
    orders.designer_not_accepted_reason AS REASON
from 
TRACKER_ORDERS_FABRIC orders 
JOIN TRACKER_REQUISITION_FABRIC requis ON orders.fabric_requisition_id=requis.fabric_requisition_id 
WHERE orders.issued='Y' and orders.delivered='Y' and orders.designer_returned='Y' AND orders.department_returned_date IS NULL
UNION ALL
select 
    requis.fabric_requisition_id,
    requis.issue_min_date,
    requis.issue_max_date,
    requis.transaction_id,
    requis.delivery_min_date,
    requis.delivery_max_date,
    requis.category_name,
    requis.style_code,
    requis.designer_code,
    requis.color_code,
    requis.product_codes,
    requis.item_code,
    requis.production_types,
    requis.fabric_code,
    requis.fabric_name,
    requis.fabric_type,
    custom_orders.fabric_length,
    custom_orders.fabric_width,
    custom_orders.fabric_shrinkage,
    custom_orders.fabric_pcs,
    custom_orders.fabric_total_measurement,
    requis.approved,
    orders.order_id,
    orders.fabric_order_no,
    orders.customized,
    custom_orders.fabric_custom_order_id AS custom_order_id,
    custom_orders.fabric_length AS custom_fabric_length,
    custom_orders.fabric_width AS custom_fabric_width,
    custom_orders.fabric_shrinkage AS custom_fabric_shrinkage,
    custom_orders.fabric_pcs AS custom_fabric_pcs,
    custom_orders.fabric_total_measurement AS custom_fabric_total_measurement,
    custom_orders.designer_not_accepted_reason AS REASON
from 
TRACKER_CUSTOM_ORDERS_FABRIC custom_orders 
JOIN TRACKER_ORDERS_FABRIC orders ON orders.order_id=custom_orders.order_id
JOIN TRACKER_REQUISITION_FABRIC requis ON orders.fabric_requisition_id=requis.fabric_requisition_id 
WHERE custom_orders.issued='Y' and custom_orders.delivered='Y' and custom_orders.designer_returned='Y' AND custom_orders.department_returned_date IS NULL;
